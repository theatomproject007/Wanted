<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vintage Wanted Poster Generator</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Rye&family=Special+Elite&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Special Elite', cursive;
            background-color: #f5e8c7;
            color: #4a2c2a;
            min-height: 100vh;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 1rem;
        }
        
        .wanted-font {
            font-family: 'Rye', serif;
        }
        
        #app-container {
            max-width: 700px;
            width: 100%;
            text-align: center;
        }
        
        #camera-view video {
            width: 100%;
            height: auto;
            object-fit: cover;
            border: 4px solid #a18069;
            border-radius: 8px;
            background-color: #333;
        }
        
        #camera-feedback {
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 1.25rem;
        }
        
        .btn {
            display: inline-block;
            font-weight: bold;
            padding: 0.75rem 1rem;
            border-radius: 8px;
            font-size: 1.2rem;
            border: none;
            cursor: pointer;
            color: white;
            margin: 0.25rem;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
        
        .btn-brown {
            background-color: #7a5c49;
        }
        
        .btn-brown:hover {
            background-color: #5a3d2b;
        }
        
        .btn-gray {
            background-color: #666;
        }
        
        .btn-gray:hover {
            background-color: #444;
        }
        
        .btn-green {
            background-color: #1e7b1e;
        }
        
        .btn-green:hover {
            background-color: #145214;
        }
        
        .btn-blue {
            background-color: #1d4ed8;
        }
        
        .btn-blue:hover {
            background-color: #153eaa;
        }
        
        #poster {
            background-color: #e8d9b7;
            border: 20px solid #5a3d2b;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
            padding: 1.5rem;
        }
        
        #poster-title {
            font-size: 4rem;
        }
        
        #poster-subtitle {
            font-size: 2rem;
            margin-top: -0.5rem;
        }
        
        #poster canvas {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 0 auto;
            border: 4px solid #4a2c2a;
            background-color: #d7c4a0;
        }
        
        .charges-text {
            font-weight: bold;
            font-size: 1.5rem;
        }
        
        .reward-label {
            font-size: 1.5rem;
        }
        
        .reward-amount {
            font-size: 3rem;
        }
        
        .space-y-2>* {
            margin: 0.5rem 0;
        }
        
        .mt-6 {
            margin-top: 1.5rem;
        }
        
        .mt-4 {
            margin-top: 1rem;
        }
        
        @media print {
            body * {
                visibility: hidden;
            }
            #poster,
            #poster * {
                visibility: visible;
            }
            #poster {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                height: 100%;
                border: none;
                box-shadow: none;
                margin: 0;
                padding: 20px;
                box-sizing: border-box;
            }
            .no-print {
                display: none;
            }
        }
    </style>
</head>

<body>
    <div id="app-container">
        <div id="camera-view">
            <h1 class="wanted-font" id="mugshot-title">Get Your Mugshot</h1>
            <div style="position:relative;">
                <video id="video" autoplay playsinline></video>
                <div id="camera-feedback">Starting camera...</div>
            </div>
            <div>
                <button id="snap" class="btn btn-brown">Take Picture</button>
                <button id="switch-camera" class="btn btn-gray">Switch Cam</button>
            </div>
        </div>
        <div id="result-view" style="display:none;">
            <div id="poster">
                <h1 class="wanted-font" id="poster-title">WANTED</h1>
                <h2 class="wanted-font" id="poster-subtitle">DEAD OR ALIVE</h2>
                <div class="mt-4">
                    <canvas id="photo-canvas"></canvas>
                </div>
                <div class="space-y-2">
                    <p>For crimes against good taste, including but not limited to:</p>
                    <p id="charges" class="charges-text"></p>
                </div>
                <div class="wanted-font mt-6">
                    <p class="reward-label">REWARD</p>
                    <p id="bounty" class="reward-amount"></p>
                </div>
            </div>
            <div class="mt-6 no-print">
                <button id="retake" class="btn btn-brown">Try Again</button>
                <a id="download" href="#" download="wanted-poster.png" class="btn btn-green">Download</a>
                <button id="print" class="btn btn-blue">Print</button>
            </div>
        </div>
        <canvas id="capture-canvas" style="display:none;"></canvas>
    </div>
    <script>
        const video = document.getElementById('video');
        const snapButton = document.getElementById('snap');
        const switchCameraButton = document.getElementById('switch-camera');
        const retakeButton = document.getElementById('retake');
        const downloadButton = document.getElementById('download');
        const printButton = document.getElementById('print');
        const cameraView = document.getElementById('camera-view');
        const resultView = document.getElementById('result-view');
        const captureCanvas = document.getElementById('capture-canvas');
        const photoCanvas = document.getElementById('photo-canvas');
        const bountyEl = document.getElementById('bounty');
        const chargesEl = document.getElementById('charges');
        const cameraFeedback = document.getElementById('camera-feedback');
        let currentFacingMode = 'user';
        const chargesList = [
            "Stealing PB&J from the trash can of Oscar the Grouch.",
            "Telling dad jokes at a comedy club.",
            "Putting pineapple on pizza, despite numerous warnings.",
            "Double-dipping chips at a party.",
            "Leaving shopping carts in the middle of the parking lot.",
            "Talking during a movie at the theater.",
            "Wearing socks with sandals.",
            "Rewinding a rented movie only halfway.",
            "Claiming 'it's a feature, not a bug'."
        ];

        function stopVideoStream() {
            if (video.srcObject) {
                video.srcObject.getTracks().forEach(t => t.stop());
                video.srcObject = null;
            }
        }
        async function startCamera() {
            stopVideoStream();
            snapButton.disabled = true;
            switchCameraButton.disabled = true;
            cameraFeedback.style.display = 'flex';
            try {
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: {
                        facingMode: currentFacingMode,
                        width: {
                            ideal: 1080
                        },
                        height: {
                            ideal: 1080
                        }
                    }
                });
                video.srcObject = stream;
                video.onloadedmetadata = () => {
                    cameraFeedback.style.display = 'none';
                    snapButton.disabled = false;
                    switchCameraButton.disabled = false;
                };
            } catch (err) {
                console.error(err);
                cameraFeedback.textContent = 'Could not access camera';
            }
        }

        function generatePoster() {
            const captureCtx = captureCanvas.getContext('2d');
            captureCanvas.width = video.videoWidth;
            captureCanvas.height = video.videoHeight;
            if (currentFacingMode === 'user') {
                captureCtx.translate(video.videoWidth, 0);
                captureCtx.scale(-1, 1);
            }
            captureCtx.drawImage(video, 0, 0);
            const photoCtx = photoCanvas.getContext('2d');
            photoCanvas.width = video.videoWidth;
            photoCanvas.height = video.videoHeight;
            photoCtx.filter = 'grayscale(1)';
            photoCtx.drawImage(captureCanvas, 0, 0);
            const randomBounty = Math.floor(Math.random() * 9500) + 501;
            bountyEl.textContent = `$${randomBounty}`;
            chargesEl.textContent = '"' + chargesList[Math.floor(Math.random() * chargesList.length)] + '"';
            cameraView.style.display = 'none';
            resultView.style.display = 'block';
            stopVideoStream();
            setTimeout(generateDownloadableImage, 100);
        }

        function generateDownloadableImage() {
            const finalCanvas = document.createElement('canvas');
            finalCanvas.width = photoCanvas.width;
            finalCanvas.height = photoCanvas.height;
            const ctx = finalCanvas.getContext('2d');
            ctx.drawImage(photoCanvas, 0, 0);
            downloadButton.href = finalCanvas.toDataURL('image/png');
        }
        snapButton.addEventListener('click', generatePoster);
        switchCameraButton.addEventListener('click', () => {
            currentFacingMode = currentFacingMode === 'user' ? 'environment' : 'user';
            startCamera();
        });
        retakeButton.addEventListener('click', () => {
            resultView.style.display = 'none';
            cameraView.style.display = 'block';
            startCamera();
        });
        printButton.addEventListener('click', () => window.print());
        window.addEventListener('load', startCamera);
    </script>
</body>

</html>